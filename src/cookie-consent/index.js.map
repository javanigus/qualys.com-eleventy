{"version":3,"file":"index.js","names":["setDNTCookie","value","now","Date","expires","moment","add","hostname","window","location","match","cookie","concat","toDate","toUTCString","protocol","join","document","localStorage","setItem","JSON","stringify","date","toISOString","dnt","ip","sessionStorage","getItem","setTimeout","reload","allowTrackingForOneYear","disabled","buttonRevoke","removeAttribute","nextElementSibling","innerHTML","disallowTrackingForOneYear","buttonGive","updateTimeElements","timestamp","timeElements","querySelectorAll","i","l","length","timeElement","datetime","tz","guess","setAttribute","format","locale","navigator","languages","language","querySelector","addEventListener","dntConsent","endDate","data","parse","start","parseZone","ipElements","ipTexts","classList","remove","subtract","console","warn","consentYes","consentNo","consentUnknown","consentCheck"],"sources":["../../site/pages/cookie-consent/index.js"],"sourcesContent":["/* global moment */\n\n/*\n * cookie consent section\n */\n(function () {\n\n\t\"use strict\";\n\n\t// set the locale based on the user's browser\n\tmoment.locale(window.navigator.languages || window.navigator.language);\n\n\tfunction setDNTCookie (value) {\n\n\t\t// set a cookie to expire in 1 year\n\t\tconst now = new Date();\n\t\tconst expires = moment().add(1, \"year\");\n\n\t\t// set hostname for all sub-domains of qualys.com\n\t\tlet hostname = window.location.hostname;\n\t\tif (hostname.match(/qualys\\.com$/)) {\n\t\t\thostname = \".qualys.com\";\n\t\t}\n\t\tconst cookie = [\n\t\t\t\"dnt=\" + ((value === 0 || value === \"0\" || !value) ? \"0\" : \"1\"),\n\t\t\t`domain=${hostname}`,\n\t\t\t\"path=/\",\n\t\t\t\"expires=\" + expires.toDate().toUTCString(),\n\t\t\t((window.location.protocol === \"https:\") ? \"secure=yes\" : null)\n\t\t].join(\"; \");\n\t\tdocument.cookie = cookie;\n\n\t\t// store expiration date in local storage so it may be retrieved later\n\t\tif (window.localStorage) {\n\n\t\t\t// document date and IP address when consent was given\n\t\t\tlocalStorage.setItem(\"dntConsent\", JSON.stringify({\n\t\t\t\t\"date\": now.toISOString(),\n\t\t\t\t\"dnt\": ((value === 0 || value === \"0\" || !value) ? \"0\" : \"1\"),\n\t\t\t\t\"ip\": sessionStorage.getItem(\"ipify.ip\")\n\t\t\t}));\n\n\t\t}\n\n\t\tsetTimeout(function () {\n\n\t\t\twindow.location.reload();\n\n\t\t}, 600);\n\n\t}\n\n\tfunction allowTrackingForOneYear () {\n\n\t\tthis.disabled = \"disabled\";\n\t\tbuttonRevoke.disabled = \"disabled\";\n\t\tbuttonRevoke.removeAttribute(\"checked\");\n\t\tif (this.nextElementSibling) {\n\t\t\tthis.nextElementSibling.innerHTML = \"Saving …\";\n\t\t}\n\t\tsetDNTCookie(false);\n\n\t}\n\n\tfunction disallowTrackingForOneYear () {\n\n\t\tthis.disabled = \"disabled\";\n\t\tbuttonGive.disabled = \"disabled\";\n\t\tbuttonGive.removeAttribute(\"checked\");\n\t\tif (this.nextElementSibling) {\n\t\t\tthis.nextElementSibling.innerHTML = \"Saving …\";\n\t\t}\n\t\tsetDNTCookie(true);\n\n\t}\n\n\t// helper function to update time elements\n\tfunction updateTimeElements(timestamp) {\n\n\t\tconst timeElements = document.querySelectorAll(\"time\");\n\t\tfor (let i = 0, l = timeElements.length; i < l; i += 1) {\n\n\t\t\tconst timeElement = timeElements[i];\n\t\t\tif (timestamp) {\n\n\t\t\t\t// date and time are known\n\t\t\t\tconst datetime = moment(timestamp).tz(moment.tz.guess());\n\t\t\t\ttimeElement.setAttribute(\"datetime\", datetime.format());\n\t\t\t\ttimeElement.innerHTML = datetime.format(\"LLLL z\");\n\n\t\t\t} else {\n\n\t\t\t\t// unusal case where date and time are unknown\n\t\t\t\ttimeElement.removeAttribute(\"datetime\");\n\t\t\t\ttimeElement.innerHTML = \"some unknown date\";\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t// bind callbacks to buttons\n\tconst buttonGive = document.querySelector(\"#yes_i_accept_cookies\");\n\tif (buttonGive) {\n\t\tbuttonGive.addEventListener(\"click\", allowTrackingForOneYear);\n\t}\n\tconst buttonRevoke = document.querySelector(\"#no_thanks\");\n\tif (buttonRevoke) {\n\t\tbuttonRevoke.addEventListener(\"click\", disallowTrackingForOneYear);\n\t}\n\n\t// update start and end dates for consent\n\t// based on cookie expiration date in local storage\n\tif (document.cookie.match(/\\bdnt=[01]\\b/)) {\n\n\t\t// check new \"dntConsent\" item\n\t\t// and check old \"dntExpires\" item\n\t\tconst dntConsent = localStorage.getItem(\"dntConsent\");\n\t\tconst endDate = localStorage.getItem(\"dntExpires\");\n\t\tif (dntConsent) {\n\n\t\t\t// prefer new \"dntConsent\" item\n\t\t\tconst data = JSON.parse(dntConsent);\n\t\t\tif (data.date) {\n\n\t\t\t\tconst start = moment.parseZone(data.date);\n\t\t\t\tupdateTimeElements(start);\n\n\t\t\t}\n\n\t\t\t// report documented IP address\n\t\t\tif (data.ip) {\n\n\t\t\t\tconst ipElements = document.querySelectorAll(\".cookie-consent-ip-address\");\n\t\t\t\tif (ipElements) {\n\t\t\t\t\tfor (let i = 0, l = ipElements.length; i < l; i += 1) {\n\n\t\t\t\t\t\tipElements[i].innerHTML = data.ip;\n\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst ipTexts = document.querySelectorAll(\".cookie-consent-ip-address-text\");\n\t\t\t\tif (ipTexts) {\n\t\t\t\t\tfor (let i = 0, l = ipTexts.length; i < l; i += 1) {\n\n\t\t\t\t\t\tipTexts[i].classList.remove(\"hidden\");\n\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else if (endDate) {\n\n\t\t\t// fallback back to old \"dntExpires\" item\n\t\t\tconst start = moment.parseZone(endDate).subtract(1, \"year\");\n\t\t\tupdateTimeElements(start);\n\n\t\t} else {\n\n\t\t\t/* eslint-disable no-console */\n\t\t\tconsole.warn(\"DNT cookie found without related data in local storage.\");\n\t\t\tupdateTimeElements();\n\t\t\t/* eslint-enable no-console */\n\n\t\t}\n\n\t}\n\n\t// show the relavent section based on cookie\n\tif (document.cookie.match(/\\bdnt=0\\b/)) {\n\n\t\t// show the consent given section\n\t\tconst consentYes = document.querySelector(\".cookie-consent-yes\");\n\t\tif (consentYes) {\n\t\t\tconsentYes.classList.remove(\"hidden\");\n\t\t}\n\n\t\t// select the Yes checkbox\n\t\tbuttonGive.setAttribute(\"checked\", \"checked\");\n\n\t} else if (document.cookie.match(/\\bdnt=1\\b/)) {\n\n\t\t// show the consent not given section\n\t\tconst consentNo = document.querySelector(\".cookie-consent-no\");\n\t\tif (consentNo) {\n\t\t\tconsentNo.classList.remove(\"hidden\");\n\t\t}\n\n\t\t// select the No checkbox\n\t\tbuttonRevoke.setAttribute(\"checked\", \"checked\");\n\n\t} else {\n\n\t\t// show the Unknown Consent section\n\t\tconst consentUnknown = document.querySelector(\".cookie-consent-unknown\");\n\t\tif (consentUnknown) {\n\t\t\tconsentUnknown.classList.remove(\"hidden\");\n\t\t}\n\n\t}\n\n\t// find and store the \"checking consent\" element\n\tconst consentCheck = document.querySelector(\".cookie-consent-checking\");\n\tif (consentCheck) {\n\t\tconsentCheck.classList.add(\"hidden\");\n\t}\n\n}());\n"],"mappings":"aAAA,oBAEA;AACA;AACA,GACC,WAAY,CAEZ,YAAY,CAEZ;AAGA,QAAS,CAAAA,CAAYA,CAAEC,CAAK,CAAE,CAE7B;AAAA,KACM,CAAAC,CAAG,CAAG,GAAI,CAAAC,IAAM,CAChBC,CAAO,CAAGC,MAAM,CAAC,CAAC,CAACC,GAAG,CAAC,CAAC,CAAE,MAAM,CAAC,CAEvC;AACA,GAAI,CAAAC,CAAQ,CAAGC,MAAM,CAACC,QAAQ,CAACF,QAAQ,CACnCA,CAAQ,CAACG,KAAK,CAAC,cAAc,CAAC,GACjCH,CAAQ,CAAG,aAAa,EAEzB,KAAM,CAAAI,CAAM,CAAG,CACd,MAAM,EAAe,CAAC,GAAXV,CAAW,EAAc,GAAG,GAAbA,CAAa,EAAKA,CAAK,CAAU,GAAG,CAAT,GAAS,CAAC,WAAAW,MAAA,CACrDL,CAAQ,EAClB,QAAQ,CACR,UAAU,CAAGH,CAAO,CAACS,MAAM,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC,CACZ,QAAQ,GAArCN,MAAM,CAACC,QAAQ,CAACM,QAAqB,CAAI,YAAY,CAAG,IAAI,CAC9D,CAACC,IAAI,CAAC,IAAI,CAAC,CACZC,QAAQ,CAACN,MAAM,CAAGA,CAAM,CAGpBH,MAAM,CAACU,YAAY,EAGtBA,YAAY,CAACC,OAAO,CAAC,YAAY,CAAEC,IAAI,CAACC,SAAS,CAAC,CACjDC,IAAA,CAAQpB,CAAG,CAACqB,WAAW,CAAC,CAAC,CACzBC,GAAA,CAAmB,CAAC,GAAXvB,CAAW,EAAc,GAAG,GAAbA,CAAa,EAAKA,CAAK,CAAU,GAAG,CAAT,GAAU,CAC7DwB,EAAA,CAAMC,cAAc,CAACC,OAAO,CAAC,UAAU,CACxC,CAAC,CAAC,CAAC,CAIJC,UAAU,CAAC,UAAY,CAEtBpB,MAAM,CAACC,QAAQ,CAACoB,MAAM,CAAC,CAExB,CAAC,CAAE,GAAG,CAEP,CAEA,QAAS,CAAAC,CAAuBA,CAAA,CAAI,CAEnC,IAAI,CAACC,QAAQ,CAAG,UAAU,CAC1BC,CAAY,CAACD,QAAQ,CAAG,UAAU,CAClCC,CAAY,CAACC,eAAe,CAAC,SAAS,CAAC,CACnC,IAAI,CAACC,kBAAkB,GAC1B,IAAI,CAACA,kBAAkB,CAACC,SAAS,CAAG,eAAU,EAE/CnC,CAAY,GAAM,CAEnB,CAEA,QAAS,CAAAoC,CAA0BA,CAAA,CAAI,CAEtC,IAAI,CAACL,QAAQ,CAAG,UAAU,CAC1BM,CAAU,CAACN,QAAQ,CAAG,UAAU,CAChCM,CAAU,CAACJ,eAAe,CAAC,SAAS,CAAC,CACjC,IAAI,CAACC,kBAAkB,GAC1B,IAAI,CAACA,kBAAkB,CAACC,SAAS,CAAG,eAAU,EAE/CnC,CAAY,GAAK,CAElB,CAEA;AACA,QAAS,CAAAsC,CAAkBA,CAACC,CAAS,CAAE,CAEtC,KAAM,CAAAC,CAAY,CAAGvB,QAAQ,CAACwB,gBAAgB,CAAC,MAAM,CAAC,CACtD,IAAK,GAAI,CAAAC,CAAC,CAAG,CAAC,CAAEC,CAAC,CAAGH,CAAY,CAACI,MAAM,CAAEF,CAAC,CAAGC,CAAC,CAAED,CAAC,EAAI,CAAC,CAAE,CAEvD,KAAM,CAAAG,CAAW,CAAGL,CAAY,CAACE,CAAC,CAAC,CACnC,GAAIH,CAAS,CAAE,CAEd;AACA,KAAM,CAAAO,CAAQ,CAAGzC,MAAM,CAACkC,CAAS,CAAC,CAACQ,EAAE,CAAC1C,MAAM,CAAC0C,EAAE,CAACC,KAAK,CAAC,CAAC,CAAC,CACxDH,CAAW,CAACI,YAAY,CAAC,UAAU,CAAEH,CAAQ,CAACI,MAAM,CAAC,CAAC,CAAC,CACvDL,CAAW,CAACV,SAAS,CAAGW,CAAQ,CAACI,MAAM,CAAC,QAAQ,CAEjD,CAAC,IAEA;AACAL,CAAW,CAACZ,eAAe,CAAC,UAAU,CAAC,CACvCY,CAAW,CAACV,SAAS,CAAG,mBAI1B,CAED,CAEA;AA5FA9B,MAAM,CAAC8C,MAAM,CAAC3C,MAAM,CAAC4C,SAAS,CAACC,SAAS,EAAI7C,MAAM,CAAC4C,SAAS,CAACE,QAAQ,CAAC,CA6FtE,KAAM,CAAAjB,CAAU,CAAGpB,QAAQ,CAACsC,aAAa,CAAC,uBAAuB,CAAC,CAC9DlB,CAAU,EACbA,CAAU,CAACmB,gBAAgB,CAAC,OAAO,CAAE1B,CAAuB,CAAC,CAE9D,KAAM,CAAAE,CAAY,CAAGf,QAAQ,CAACsC,aAAa,CAAC,YAAY,CAAC,CAKzD;AACA;AACA,GANIvB,CAAY,EACfA,CAAY,CAACwB,gBAAgB,CAAC,OAAO,CAAEpB,CAA0B,CAAC,CAK/DnB,QAAQ,CAACN,MAAM,CAACD,KAAK,CAAC,cAAc,CAAC,CAAE,CAE1C;AACA;AAAA,KACM,CAAA+C,CAAU,CAAGvC,YAAY,CAACS,OAAO,CAAC,YAAY,CAAC,CAC/C+B,CAAO,CAAGxC,YAAY,CAACS,OAAO,CAAC,YAAY,CAAC,CAClD,GAAI8B,CAAU,CAAE,CAEf;AACA,KAAM,CAAAE,CAAI,CAAGvC,IAAI,CAACwC,KAAK,CAACH,CAAU,CAAC,CACnC,GAAIE,CAAI,CAACrC,IAAI,CAAE,CAEd,KAAM,CAAAuC,CAAK,CAAGxD,MAAM,CAACyD,SAAS,CAACH,CAAI,CAACrC,IAAI,CAAC,CACzCgB,CAAkB,CAACuB,CAAK,CAEzB,CAEA;AACA,GAAIF,CAAI,CAAClC,EAAE,CAAE,CAEZ,KAAM,CAAAsC,CAAU,CAAG9C,QAAQ,CAACwB,gBAAgB,CAAC,4BAA4B,CAAC,CAC1E,GAAIsB,CAAU,CACb,IAAK,GAAI,CAAArB,CAAC,CAAG,CAAC,CAAEC,CAAC,CAAGoB,CAAU,CAACnB,MAAM,CAAEF,CAAC,CAAGC,CAAC,CAAED,CAAC,EAAI,CAAC,CAEnDqB,CAAU,CAACrB,CAAC,CAAC,CAACP,SAAS,CAAGwB,CAAI,CAAClC,EAAE,CAKnC,KAAM,CAAAuC,CAAO,CAAG/C,QAAQ,CAACwB,gBAAgB,CAAC,iCAAiC,CAAC,CAC5E,GAAIuB,CAAO,CACV,IAAK,GAAI,CAAAtB,CAAC,CAAG,CAAC,CAAEC,CAAC,CAAGqB,CAAO,CAACpB,MAAM,CAAEF,CAAC,CAAGC,CAAC,CAAED,CAAC,EAAI,CAAC,CAEhDsB,CAAO,CAACtB,CAAC,CAAC,CAACuB,SAAS,CAACC,MAAM,CAAC,QAAQ,CAKvC,CAED,CAAC,IAAM,IAAIR,CAAO,CAAE,CAEnB;AACA,KAAM,CAAAG,CAAK,CAAGxD,MAAM,CAACyD,SAAS,CAACJ,CAAO,CAAC,CAACS,QAAQ,CAAC,CAAC,CAAE,MAAM,CAAC,CAC3D7B,CAAkB,CAACuB,CAAK,CAEzB,CAAC,IAEA,+BACAO,OAAO,CAACC,IAAI,CAAC,yDAAyD,CAAC,CACvE/B,CAAkB,CAAC,CAKrB,CAEA;AACA,GAAIrB,QAAQ,CAACN,MAAM,CAACD,KAAK,CAAC,WAAW,CAAC,CAAE,CAEvC;AACA,KAAM,CAAA4D,CAAU,CAAGrD,QAAQ,CAACsC,aAAa,CAAC,qBAAqB,CAAC,CAC5De,CAAU,EACbA,CAAU,CAACL,SAAS,CAACC,MAAM,CAAC,QAAQ,CAAC,CAItC7B,CAAU,CAACY,YAAY,CAAC,SAAS,CAAE,SAAS,CAE7C,CAAC,IAAM,IAAIhC,QAAQ,CAACN,MAAM,CAACD,KAAK,CAAC,WAAW,CAAC,CAAE,CAE9C;AACA,KAAM,CAAA6D,CAAS,CAAGtD,QAAQ,CAACsC,aAAa,CAAC,oBAAoB,CAAC,CAC1DgB,CAAS,EACZA,CAAS,CAACN,SAAS,CAACC,MAAM,CAAC,QAAQ,CAAC,CAIrClC,CAAY,CAACiB,YAAY,CAAC,SAAS,CAAE,SAAS,CAE/C,CAAC,IAAM,CAEN;AACA,KAAM,CAAAuB,CAAc,CAAGvD,QAAQ,CAACsC,aAAa,CAAC,yBAAyB,CAAC,CACpEiB,CAAc,EACjBA,CAAc,CAACP,SAAS,CAACC,MAAM,CAAC,QAAQ,CAG1C,CAEA;AACA,KAAM,CAAAO,CAAY,CAAGxD,QAAQ,CAACsC,aAAa,CAAC,0BAA0B,CAAC,CACnEkB,CAAY,EACfA,CAAY,CAACR,SAAS,CAAC3D,GAAG,CAAC,QAAQ,CAGrC,CAAC,EAAC,CAAC"}