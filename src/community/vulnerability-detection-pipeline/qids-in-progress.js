"use strict";function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}function _defineProperty(a,b,c){return b=_toPropertyKey(b),b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _toPropertyKey(a){var b=_toPrimitive(a,"string");return"symbol"==typeof b?b:b+""}function _toPrimitive(a,b){if("object"!=typeof a||!a)return a;var c=a[Symbol.toPrimitive];if(void 0!==c){var d=c.call(a,b||"default");if("object"!=typeof d)return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)}if("undefined"!=typeof require)var React=require("react"),moment=require("moment");const statusOptions=[{key:0,name:"Under Investigation",value:"No"},{key:1,name:"In Development",value:"In QA"},{key:2,name:"Recently Published",value:"Yes"}],publishedToStatus=statusOptions.reduce((a,b)=>(a[b.value]=b.name,a),{});class FilterableTable extends React.Component{constructor(a){// try to restore previous state
if(super(a),this.state={published:"",severities:[5,4,3,2,1],query:""},this.handleFilterChange=this.handleFilterChange.bind(this),this.handleHashChange=this.handleHashChange.bind(this),"undefined"!=typeof sessionStorage){let a=sessionStorage.getItem("QIDsInProgressFilterState");if(a)try{this.state=_objectSpread(_objectSpread({},this.state),JSON.parse(a))}catch(b){console.log({sessionState:a}),console.error(b)}}if("undefined"!=typeof window&&window.location){const a=window.location,b=a.hash.slice(1),c=b.match(/^qid-(\d+)/i);c&&(this.state.query=c[1]);const d=b.match(/^cve-(\d{4})-(\d+)/i);d&&(this.state.query="CVE-".concat(d[1],"-").concat(d[2]))}}componentDidMount(){window.addEventListener("hashchange",this.handleHashChange,!1)}componentWillUnmount(){window.removeEventListener("hashchange",this.handleHashChange,!1)}handleFilterChange(a){const b={published:a.published,severities:a.severities,query:a.query};this.setState(b),sessionStorage.setItem("QIDsInProgressFilterState",JSON.stringify(b))}handleHashChange(a){const b=new URL(a.newURL),c=b.hash.slice(1),d=c.match(/^qid-(\d+)/i);d&&this.setState({query:d[1]});const e=c.match(/^cve-(\d{4})-(\d+)/i);e&&this.setState({query:"CVE-".concat(e[1],"-").concat(e[2])})}render(){const a=this.props.data,b=this.state.published,c=this.state.severities,d=this.state.query;let e="";return"undefined"!=typeof window&&(e=/*#__PURE__*/React.createElement(FilterBar,{options:statusOptions,published:b,severities:c,query:d,onFilterChange:this.handleFilterChange})),/*#__PURE__*/React.createElement("div",{className:"filterableTable"},e,/*#__PURE__*/React.createElement(QIDsInProgress,{data:a,published:b,severities:c,query:d}))}}const severityLevelMap={5:{number:5,level:"Urgent",description:"Intruders can easily gain control of the host, which can lead to the compromise of your entire network security. For example, vulnerabilities at this level may include full read and write access to files, remote execution of commands, and the presence of backdoors."},4:{number:4,level:"Critical",description:"Intruders can possibly gain control of the host, or there may be potential leakage of highly sensitive information. For example, vulnerabilities at this level may include full read access to files, potential backdoors, or a listing of all the users on the host."},3:{number:3,level:"Serious",description:"Intruders may be able to gain access to specific information stored on the host, including security settings. This could result in potential misuse of the host by intruders. For example, vulnerabilities at this level may include partial disclosure of file contents, access to certain files on the host, directory browsing, disclosure of filtering rules and security mechanisms, denial of service attacks, and unauthorized use of services, such as mail-relaying."},2:{number:2,level:"Medium",description:"Intruders may be able to collect sensitive information from the host, such as the precise version of software installed. With this information, intruders can easily exploit known vulnerabilities specific to software versions."},1:{number:1,level:"Minimal",description:"Intruders can collect information about the host (open ports, services, etc.) and may be able to use this information to find other vulnerabilities."}};class FilterBar extends React.Component{constructor(a){super(a),this.state={severities:this.props.severities},this.handleChange=this.handleChange.bind(this),this.handleClick=this.handleClick.bind(this),this.formPreventDefault=this.formPreventDefault.bind(this)}handleChange(){var a=this.selectElement,b=this.inputElement;this.props.onFilterChange({published:a.options[a.selectedIndex].value,severities:this.state.severities,query:b.value})}handleClick(a){if(a.target){const b=a.target.getAttribute("data-value");if(b){const a=parseInt(b,10),c=this.state.severities,d=c.indexOf(a);-1<d?c.splice(d,1):c.push(a),this.setState({severities:c}),this.handleChange()}}}formPreventDefault(a){return a.preventDefault(),!1}render(){const a=this.props.published,b=this.props.query;var c=this.props.options.map(function(b){const c=b.value===a?"selected":null;return/*#__PURE__*/React.createElement("option",{key:b.key,value:b.value,selected:c},b.name)});let d=[];for(let a in severityLevelMap){const b=severityLevelMap[a],c=this.props.severities.includes(b.number)?"selected":"";d.push(/*#__PURE__*/React.createElement("button",{type:"button","data-value":b.number,className:c,onClick:this.handleClick,title:"".concat(b.level,": ").concat(b.description)},b.number))}return d=d.reverse(),/*#__PURE__*/React.createElement("form",{className:"filterBar",onSubmit:this.formPreventDefault},/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{htmlFor:"q-filter-by-status__select"},"Include: "),/*#__PURE__*/React.createElement("select",{id:"q-filter-by-status__select",onChange:this.handleChange,ref:a=>{this.selectElement=a}},/*#__PURE__*/React.createElement("option",{value:""},"Any Status"),c)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",null,"with Severity: "),/*#__PURE__*/React.createElement("div",null,d)),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("label",{htmlFor:"q-filter-by-text"},"Search: "),/*#__PURE__*/React.createElement("input",{id:"q-filter-by-text",type:"text",value:b,onChange:this.handleChange,ref:a=>{this.inputElement=a}})))}}const FIELDS_TO_SEARCH=["qid","title","description","solution","consequence","cve_string","vendor_refs_string","patches_string"];class QIDsInProgress extends React.Component{constructor(a){// try to restore previous state
if(super(a),this.state={orderBy:{fields:[null,null,null],directions:[!1,!1,!1]}},this.handleSort=this.handleSort.bind(this),"undefined"!=typeof sessionStorage){let a=sessionStorage.getItem("QIDsInProgressSortState");if(a)try{this.state=_objectSpread(_objectSpread({},this.state),JSON.parse(a))}catch(b){console.log({sessionState:a}),console.error(b)}}}handleSort(a){const b=a.currentTarget.getAttribute("data-order-by");let c=this.state.orderBy;if(b===c.fields[0]){// toggle direction
const a=c.directions;c.directions=[!a[0],a[1],a[2]]}else{// set field to order by
const a=c.fields,d=c.directions;let e=a.indexOf(b);-1<e?(c.fields.unshift(a.splice(e,1)[0]),c.directions.unshift(d.splice(e,1)[0])):(c.fields.unshift(b),c.fields=c.fields.slice(0,3),c.directions.unshift(!0),c.directions=c.directions.slice(0,3))}this.setState({orderBy:c}),sessionStorage.setItem("QIDsInProgressSortState",JSON.stringify({orderBy:c}))}static sortColumn(c,a,b,d){const e=c[b.fields[d]],f=a[b.fields[d]],g=b.directions[d]?1:-1,h=b.directions[d]?-1:1;if("cve"===b.fields[d]){// special sort for CVEs
// first check for QIDs with empty CVE sets
if(0<e.length&&1>f.length)return g;if(1>e.length&&0<f.length)return h;if(1>e.length&&1>f.length)return d<b.fields.length?QIDsInProgress.sortColumn(c,a,b,d+=1):0;else{// if both QIDs have CVEs, then take the first CVE from each
// and compare the years and IDs from the CVE strings
let i=e[0].split("-"),j=f[0].split("-"),k=parseInt(i[1],10),l=parseInt(j[1],10),m=parseInt(i[2],10),n=parseInt(j[2],10);return k>l?g:k<l?h:m>n?g:m<n?h:d<b.fields.length?QIDsInProgress.sortColumn(c,a,b,d+=1):0}}else// standard sort for title and severity
return e>f?g:e<f?h:d<b.fields.length?QIDsInProgress.sortColumn(c,a,b,d+=1):0}render(){let a=this.props.data;const b=this.props.published,c=this.props.severities;let d=this.props.query;if(b&&(a=a.filter(a=>a.published===b)),c&&(a=a.filter(a=>c.includes(parseInt(a.severity,10)))),d){d=d.replace(/(^\s+|\s+$)/g,"");// filter QIDs by plain text query
let b=/(?:)/i;try{b=new RegExp("".concat(d),"i")}catch(a){console.warn(a)}a=a.filter(a=>{let c=!1;// generate cve_string
return a.cve_string=a.cve.join(" "),a.vendor_refs_string=a.vendor_refs.map(a=>a.vendor_ref).join(" "),a.patches_string=a.patches.map(a=>"".concat(a.os_sw," ").concat(a.component," ").concat(a.advisory_id)).join(" "),c=FIELDS_TO_SEARCH.reduce((c,d)=>{// check field
switch(typeof a[d]){case"string":c=!!(c||a[d].match(b));break;default:throw new Error("".concat(d," has unsupported field type, ").concat(typeof a[d]))}return c},c),c})}let e={cve:"",title:"",severity:""};if(this.state.orderBy.fields[0]){const c=this.state.orderBy;// console.log({ orderBy: orderBy });
// sort QIDs by order by field
a.sort((d,a)=>QIDsInProgress.sortColumn(d,a,c,0)),c.fields.forEach((a,b)=>{e[a]=0===b?c.directions[b]?"\u25B2":"\u25BC":""})}// console.debug({ qids: qids });
let f=a.map(b=>/*#__PURE__*/React.createElement(QID,{data:b,key:b.qid,expanded:1===a.length})),g="".concat(f.length," ");g+=1==f.length?"result":"results";let h=/*#__PURE__*/React.createElement("div",{className:"q-qid-in-progress__header"},/*#__PURE__*/React.createElement("div",{"data-order-by":"cve",onClick:this.handleSort},"CVE",/*#__PURE__*/React.createElement("span",null,e.cve)),/*#__PURE__*/React.createElement("div",{className:"q-qid-column__header"},"Qualys ID"),/*#__PURE__*/React.createElement("div",{"data-order-by":"title",onClick:this.handleSort},"Title",/*#__PURE__*/React.createElement("span",null,e.title)),/*#__PURE__*/React.createElement("div",{"data-order-by":"severity",onClick:this.handleSort},/*#__PURE__*/React.createElement("span",null,e.severity),"Severity"));if(1>f.length){const a=b&&" that are ".concat(publishedToStatus[b].toLowerCase());f=/*#__PURE__*/React.createElement("li",{className:"no-search-results"},/*#__PURE__*/React.createElement("p",null,"Your search ",/*#__PURE__*/React.createElement("strong",null," - ",d," - ")," did not match any QIDs in the vulnerability detection pipeline",a,"."),/*#__PURE__*/React.createElement("p",null,"Please refine your search or ",/*#__PURE__*/React.createElement("a",{href:"https://success.qualys.com/support/s/article/000002922"},"request a new QID"),"."),/*#__PURE__*/React.createElement("p",null,"For details about how Qualys manages QID requests internally, please see ",/*#__PURE__*/React.createElement("a",{href:"https://success.qualys.com/support/s/article/000006767"},"QID Feature Request Workflow"),"."),/*#__PURE__*/React.createElement("p",null,"The search query is based on regular expressions. You may use a vertical pipe as a delimiter to match multiple CVEs, e.g. \u201CCVE-2021-1234|CVE-2021-5678\u201D")),h=null}return/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("div",null,g),h,/*#__PURE__*/React.createElement("ul",{className:"q-qid-in-progress__container"},f))}}class QID extends React.Component{constructor(a){super(a),this.ref=React.createRef(),this.refDetail=React.createRef(),this.calculateCollapsedScale=this.calculateCollapsedScale.bind(this),this.handleClick=this.handleClick.bind(this),this.state={expanded:this.props.expanded||"undefined"==typeof window,css:""}}componentDidMount(){// const qid = this.props.data.qid;
// let css = this.createKeyframeAnimation(qid);
// css += this.createAnimationToggles(qid);
//console.log(css);
this.setState({css:""})}calculateCollapsedScale(){const a=this.ref.current,b=a.getBoundingClientRect(),c=a.querySelector(".q-qid-details"),d=c.getBoundingClientRect();// The QID item itself can act as the marker for the expanded state.
// The menu title can act as the marker for the collapsed state.
return{x:(b.width-d.width)/b.width,y:(b.height-d.height)/b.height}}createKeyframeAnimation(a){// Figure out the size of the element when collapsed.
let{x:b,y:c}=this.calculateCollapsedScale(),d="",e="";for(let f,g=0;100>=g;g+=1){f=this.ease(g/100);// Calculate the scale of the element.
const a=b+(1-b)*f,h=c+(1-c)*f;d+="".concat(g,"% {\n\t\t\t\ttransform: scale(").concat(a,", ").concat(h,");\n\t\t\t}");// And now the inverse for the contents.
e+="".concat(g,"% {\n\t\t\t\ttransform: scale(").concat(1/a,", ").concat(1/h,");\n\t\t\t}")}return"\n\t\t@keyframes QID".concat(a,"Animation {\n\t\t\t").concat(d,"\n\t\t}\n\n\t\t@keyframes QID").concat(a,"DetailsAnimation {\n\t\t\t").concat(e,"\n\t\t}")}ease(a){let b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:4;return 1-Math.pow(1-a,b)}createAnimationToggles(a){return"\n\t\t.qid-".concat(a,"--expanded {\n\t\t\tanimation-name: QID").concat(a,"Animation;\n\t\t\tanimation-duration: 0.4s;\n\t\t\tanimation-timing-function: linear;\n\t\t}\n\n\t\t.qid-").concat(a,"__details--expanded {\n\t\t\tanimation-name: QID").concat(a,"DetailsAnimation;\n\t\t\tanimation-duration: 0.4s;\n\t\t\tanimation-timing-function: linear;\n\t\t}\n\t\t")}handleClick(){//this.ref.current.className.add(`qid-${qid}--expanded`);
//this.refDetail.current.className.add(`qid-${qid}__details--expanded`);
// toggle expanded state
this.setState({expanded:!this.state.expanded})}render(){const a=this.props.data,b=a.cve&&a.cve.length?a.cve[0]:"\u2014",c=publishedToStatus[a.published]||a.published,d="icon/qid-status-".concat(c.toLowerCase().replace(/[^a-z]/,"-"),".svg"),e=moment(a.date_published||a.date_insert).format("LL");let f="",g="";a.cve&&1<a.cve.length&&(f=a.cve.join(", "),g="+");let h="q-qid-in-progress";this.state.expanded&&(h+=" qid-".concat(a.qid,"--expanded"));let i="q-qid-details";this.state.expanded&&(i+=" qid-".concat(a.qid,"__details--expanded"));let j="";return this.state.expanded&&(j=/*#__PURE__*/React.createElement("div",{className:i,ref:this.refDetail},/*#__PURE__*/React.createElement("dl",null,/*#__PURE__*/React.createElement("dt",null,"Qualys ID"),/*#__PURE__*/React.createElement("dd",null,a.qid)),/*#__PURE__*/React.createElement(DatePublished,{data:a.date_published}),/*#__PURE__*/React.createElement(VendorReferences,{data:a.vendor_refs}),/*#__PURE__*/React.createElement(CVEReferences,{data:a.cve}),/*#__PURE__*/React.createElement("dl",null,/*#__PURE__*/React.createElement("dt",null,"CVSS Scores"),/*#__PURE__*/React.createElement("dd",null,"Base ",a.cvss_v3.basescore," / Temporal ",a.cvss_v3.temporalscore),/*#__PURE__*/React.createElement("dt",null,"Description"),/*#__PURE__*/React.createElement("dd",{dangerouslySetInnerHTML:{__html:a.description}}),/*#__PURE__*/React.createElement("dt",null,"Consequence"),/*#__PURE__*/React.createElement("dd",{dangerouslySetInnerHTML:{__html:a.consequence}}),/*#__PURE__*/React.createElement("dt",null,"Solution"),/*#__PURE__*/React.createElement("dd",{dangerouslySetInnerHTML:{__html:a.solution}})),/*#__PURE__*/React.createElement(Patches,{data:a.patches}))),/*#__PURE__*/React.createElement("li",{id:"qid-".concat(a.qid),className:h,ref:this.ref},/*#__PURE__*/React.createElement("div",{className:"q-qid-summary"},/*#__PURE__*/React.createElement("div",{className:"q-qid-in-progress__primary-cve",title:f},b,g),/*#__PURE__*/React.createElement("div",{className:"q-qid-in-progress__primary-qid"},/*#__PURE__*/React.createElement("span",{className:"primary-qid"},"QID: "),a.qid),/*#__PURE__*/React.createElement("img",{src:d,className:"q-qid-in-progress__icon",width:"16",height:"16",alt:c,title:c}),/*#__PURE__*/React.createElement("h3",{className:"q-qid-in-progress__title",onClick:this.handleClick},a.title),/*#__PURE__*/React.createElement(Severity,{data:a.severity}),/*#__PURE__*/React.createElement("div",{className:"q-qid-status"},/*#__PURE__*/React.createElement("time",{dateTime:a.date_published||a.date_insert,title:e},c))),j)}}class Severity extends React.Component{render(){const a=severityLevelMap[this.props.data];return/*#__PURE__*/React.createElement("dl",{className:"bulletin-severity"},/*#__PURE__*/React.createElement("dt",{className:"heading--4"},"Severity"),/*#__PURE__*/React.createElement("dd",{className:"paragraph--2 severity__item",title:a.description},/*#__PURE__*/React.createElement("span",{className:"severity-level"},a.level),/*#__PURE__*/React.createElement("span",{className:"severity-gauge severity-".concat(a.number)}),/*#__PURE__*/React.createElement("span",{className:"severity-number"},a.number)))}}class DatePublished extends React.Component{render(){const a=this.props.data;return a?/*#__PURE__*/React.createElement("dl",null,/*#__PURE__*/React.createElement("dt",null,"Date Published"),/*#__PURE__*/React.createElement("dd",null,moment(a).format("LL"))):null}}class VendorReferences extends React.Component{render(){const a=this.props.data,b=a.map((a,b)=>{const c=a.vendor_ref,d=a.vendor_ref_url;return[0<b&&", ",/*#__PURE__*/React.createElement("a",{key:b,href:d},c)]});return a&&a.length?/*#__PURE__*/React.createElement("dl",{className:"q-vendor-reference__list"},/*#__PURE__*/React.createElement("dt",null,"Vendor Reference"),/*#__PURE__*/React.createElement("dd",null,b)):null}}class CVEReferences extends React.Component{render(){const a=this.props.data,b=a.map((a,b)=>[0<b&&", ",/*#__PURE__*/React.createElement("a",{key:b,href:"https://nvd.nist.gov/vuln/detail/".concat(a)},a)]);return a&&a.length?/*#__PURE__*/React.createElement("dl",{className:"q-cve-reference__list"},/*#__PURE__*/React.createElement("dt",null,"CVE Reference"),/*#__PURE__*/React.createElement("dd",null,b)):null}}class Patches extends React.Component{render(){const a=this.props.data,b=a.map((a,b)=>{const c=a.link,d=a.advisory_id,e=a.os_sw,f=a.component;return[0<b&&", ",/*#__PURE__*/React.createElement("a",{key:b,href:c}," ",e," ",f," ",d)]});return a&&a.length?/*#__PURE__*/React.createElement("dl",{className:"q-patch__list"},/*#__PURE__*/React.createElement("dt",null,"Patches"),/*#__PURE__*/React.createElement("dd",null,b)):null}}"undefined"!=typeof module&&(module.exports=FilterableTable);
//# sourceMappingURL=qids-in-progress.js.map