{"version":3,"file":"webinars-data.js","names":["moment","require","contentful","client","createClient","space","localPath","generateHtmlSafeIDs","input","toLowerCase","replace","trim","truncate","string","n","useWordBoundary","length","subString","substr","truncatedString","module","exports","getEntries","content_type","\"fields.type\"","order","then","unWrap","results","dynamicSort","property","sortOrder","a","b","result","items","filter","value","Object","keys","pastWebcasts","futureWebcasts","webcasts","sortedWebcasts","item","type","webcast","eventDate","isBefore","isAfter","sort","concat","process","env","NODE_ENV","entry","publicationDate","types","map","Array","from","Set","id","name","classList","dateOfPublication","parseZone","subtract","push","description","cssClass","join","typeId","typesAndResources","slice"],"sources":["../../site/pages/tru/webinars-data.js"],"sourcesContent":["const moment = require(\"moment-timezone\");\nconst contentful = require(\"contentful-sync-cli/contentful-local\");\nconst client = contentful.createClient({\n\tspace: \"4l0w8syj29ap\",\n\tlocalPath: \"site/cache/contentful\"\n});\n\n/**\n * helper function to create ids from strings\n * @arg {String}\n * @returns {String} with only word characters and dashes\n */\nfunction generateHtmlSafeIDs (input) {\n\treturn input && input\n\t\t.toLowerCase()\n\t\t.replace(/\\W+/g, \"-\")\n\t\t.replace(/^-+|-+$/g, \"\")\n\t\t.trim();\n}\n// truncate a string by n characters with optional word boundary\nfunction truncate (string, n, useWordBoundary) {\n\n\tstring = string.trim();\n\tif (string.length <= n) {\n\t\treturn string;\n\t}\n\n\tlet subString = string.substr(0, n - 1);\n\tlet truncatedString = subString;\n\n\tif (useWordBoundary) {\n\t\t// trim word characters between the end of the string and the last word boundry, then trim non-word characters from the end of the string\n\t\ttruncatedString = subString.replace(/\\b\\w+$/, \"\").replace(/\\W+$/, \"\");\n\t}\n\n\treturn truncatedString + \"â€¦\";\n\n}\nmodule.exports = client.getEntries({\n    \"content_type\": \"resource\",\n    \"fields.type\": \"Webcast\",\n\t\"order\": \"-fields.eventDate\"\n}).then(client.unWrap).then(function (results) {\n\t// remove empty objects from result set\n\tresults.items = results.items.filter(value => Object.keys(value).length > 0);\n\n\n\t// function to sort array of objects by property\n\tfunction dynamicSort(property) {\n\t\tvar sortOrder = 1;\n\t\tif(property[0] === \"-\") {\n\t\t\tsortOrder = -1;\n\t\t\tproperty = property.substr(1);\n\t\t}\n\t\treturn function (a,b) {\n\t\t\tvar result = (a[property] < b[property]) ? -1 : (a[property] > b[property]) ? 1 : 0;\n\t\t\treturn result * sortOrder;\n\t\t};\n\t}\n\n\tvar pastWebcasts, futureWebcasts,webcasts,sortedWebcasts;\n\n\twebcasts = results.items.filter(item => item.type === \"Webcast\");\n\t// get webcasts in the past\n\tpastWebcasts = webcasts.filter(webcast => {\n\t\tif (webcast.eventDate) {\n\t\t\treturn moment(webcast.eventDate).isBefore();\n\t\t} else {\n\t\t\treturn true;\n\t\t}\n\t});\n\n\t// get webcasts in the future\n\tfutureWebcasts = webcasts.filter(webcast => {\n\t\tif (webcast.eventDate) {\n\t\t\treturn moment(webcast.eventDate).isAfter();\n\t\t} else {\n\t\t\treturn true;\n\t\t}\n\t});\n\n\t// sort array of webcasts by eventDate and publicationDate\n\tpastWebcasts.sort(dynamicSort(\"-eventDate\")); // reverse chronological order\n\tfutureWebcasts.sort(dynamicSort(\"eventDate\")); // chronological order\n\n\t// merge the sorted future and past webcasts\n\tsortedWebcasts = futureWebcasts.concat(pastWebcasts);\n\n\t// filter out webcasts with future publication dates\n\tif (process.env.NODE_ENV === \"production\") {\n\t\twebcasts = webcasts.filter(entry => {\n\t\t\tif (entry.publicationDate) {\n\t\t\t\treturn moment(entry.publicationDate).isBefore();\n\t\t\t} else {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\t}\n// get the type of all entries\nvar types = results.items.map(entry => entry.type);\n// get a uniq Set of types\ntypes = Array.from(new Set(types));\n\n// convert the type strings to an object with id and name\ntypes = types.map(type => {\n\treturn {\n\t\tid: generateHtmlSafeIDs(type),\n\t\tname: type\n\t};\n});\n\n// create cssClass property for all items\nresults.items = results.items.map(entry => {\n\tvar classList = [\"\"];\n\n\t// append resource-new class name\n\t// when publication date is less than 2 months old\n\tif (entry.publicationDate) {\n\t\tvar dateOfPublication = moment.parseZone(entry.publicationDate);\n\n\t\tif (dateOfPublication.isAfter(moment().subtract(2, \"months\"))) {\n\t\t\tclassList.push(\"resource-new\");\n\t\t}\n\t}\n\n\tif (entry.type === \"Webcast\") {\n\t\tif (entry.description) {\n\t\t\tentry.description = truncate(entry.description, 90, true);\n\t\t}\n\t\tentry.webcast = true;\n\t}\n\t// create css class name as a string\n\tentry.cssClass = classList.join(\" \");\n\tentry.typeId = generateHtmlSafeIDs(entry.type);\n\n\treturn entry;\n});\n\n// loop over each type and create a new typesAndResources array of objects containing the type and an array of resources of that type\nresults.typesAndResources = types.map(type => {\n\treturn {\n\t\ttype: type,\n\t\titems: results.items.filter(entry => entry.type === type.name)\n\t};\n});\n\n\t// filter out webcasts without dates\n\n\twebcasts = sortedWebcasts.slice(0, 2);\n\treturn webcasts;\n});\n"],"mappings":"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"}